{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"/Users/nicholasschepisi/Desktop/code/bbb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.marshaller = void 0;\nvar utils_1 = require(\"@0x/utils\");\nvar ethereum_types_1 = require(\"ethereum-types\");\nvar ethUtil = require(\"ethereumjs-util\");\nvar _ = require(\"lodash\");\nvar utils_2 = require(\"./utils\");\n/**\n * Utils to convert ethereum structures from user-space format to RPC format. (marshall/unmarshall)\n */\nexports.marshaller = {\n  /**\n   * Unmarshall block without transaction data\n   * @param blockWithHexValues block to unmarshall\n   * @return unmarshalled block without transaction data\n   */\n  unmarshalIntoBlockWithoutTransactionData: function unmarshalIntoBlockWithoutTransactionData(blockWithHexValues) {\n    var block = Object.assign(Object.assign({}, blockWithHexValues), {\n      gasLimit: utils_2.utils.convertHexToNumber(blockWithHexValues.gasLimit),\n      gasUsed: utils_2.utils.convertHexToNumber(blockWithHexValues.gasUsed),\n      size: utils_2.utils.convertHexToNumber(blockWithHexValues.size),\n      timestamp: utils_2.utils.convertHexToNumber(blockWithHexValues.timestamp),\n      number: blockWithHexValues.number === null ? null : utils_2.utils.convertHexToNumber(blockWithHexValues.number),\n      difficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.difficulty),\n      totalDifficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.totalDifficulty)\n    });\n    return block;\n  },\n  /**\n   * Unmarshall block with transaction data\n   * @param blockWithHexValues block to unmarshall\n   * @return unmarshalled block with transaction data\n   */\n  unmarshalIntoBlockWithTransactionData: function unmarshalIntoBlockWithTransactionData(blockWithHexValues) {\n    var block = Object.assign(Object.assign({}, blockWithHexValues), {\n      gasLimit: utils_2.utils.convertHexToNumber(blockWithHexValues.gasLimit),\n      gasUsed: utils_2.utils.convertHexToNumber(blockWithHexValues.gasUsed),\n      size: utils_2.utils.convertHexToNumber(blockWithHexValues.size),\n      timestamp: utils_2.utils.convertHexToNumber(blockWithHexValues.timestamp),\n      number: blockWithHexValues.number === null ? null : utils_2.utils.convertHexToNumber(blockWithHexValues.number),\n      difficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.difficulty),\n      totalDifficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.totalDifficulty),\n      transactions: []\n    });\n    block.transactions = _.map(blockWithHexValues.transactions, function (tx) {\n      var transaction = exports.marshaller.unmarshalTransaction(tx);\n      return transaction;\n    });\n    return block;\n  },\n  /**\n   * Unmarshall transaction\n   * @param txRpc transaction to unmarshall\n   * @return unmarshalled transaction\n   */\n  unmarshalTransaction: function unmarshalTransaction(txRpc) {\n    var tx = Object.assign(Object.assign({}, txRpc), {\n      blockNumber: txRpc.blockNumber !== null ? utils_2.utils.convertHexToNumber(txRpc.blockNumber) : null,\n      transactionIndex: txRpc.transactionIndex !== null ? utils_2.utils.convertHexToNumber(txRpc.transactionIndex) : null,\n      nonce: utils_2.utils.convertHexToNumber(txRpc.nonce),\n      gas: utils_2.utils.convertHexToNumber(txRpc.gas),\n      gasPrice: txRpc.gasPrice !== undefined ? utils_2.utils.convertAmountToBigNumber(txRpc.gasPrice) : undefined,\n      maxFeePerGas: txRpc.maxFeePerGas !== undefined ? utils_2.utils.convertAmountToBigNumber(txRpc.maxFeePerGas) : undefined,\n      maxPriorityFeePerGas: txRpc.maxPriorityFeePerGas !== undefined ? utils_2.utils.convertAmountToBigNumber(txRpc.maxPriorityFeePerGas) : undefined,\n      value: utils_2.utils.convertAmountToBigNumber(txRpc.value)\n    });\n    return tx;\n  },\n  /**\n   * Unmarshall transaction receipt\n   * @param txReceiptRpc transaction receipt to unmarshall\n   * @return unmarshalled transaction receipt\n   */\n  unmarshalTransactionReceipt: function unmarshalTransactionReceipt(txReceiptRpc) {\n    var txReceipt = Object.assign(Object.assign({}, txReceiptRpc), {\n      blockNumber: utils_2.utils.convertHexToNumber(txReceiptRpc.blockNumber),\n      transactionIndex: utils_2.utils.convertHexToNumber(txReceiptRpc.transactionIndex),\n      cumulativeGasUsed: utils_2.utils.convertHexToNumber(txReceiptRpc.cumulativeGasUsed),\n      gasUsed: utils_2.utils.convertHexToNumber(txReceiptRpc.gasUsed),\n      logs: _.map(txReceiptRpc.logs, exports.marshaller.unmarshalLog.bind(exports.marshaller))\n    });\n    return txReceipt;\n  },\n  /**\n   * Unmarshall transaction data\n   * @param txDataRpc transaction data to unmarshall\n   * @return unmarshalled transaction data\n   */\n  unmarshalTxData: function unmarshalTxData(txDataRpc) {\n    if (txDataRpc.from === undefined) {\n      throw new Error(\"txData must include valid 'from' value.\");\n    }\n    var txData = {\n      to: txDataRpc.to,\n      from: txDataRpc.from,\n      data: txDataRpc.data,\n      value: txDataRpc.value !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.value) : undefined,\n      gas: txDataRpc.gas !== undefined ? utils_2.utils.convertHexToNumber(txDataRpc.gas) : undefined,\n      gasPrice: txDataRpc.gasPrice !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.gasPrice) : undefined,\n      maxFeePerGas: txDataRpc.maxFeePerGas !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.maxFeePerGas) : undefined,\n      maxPriorityFeePerGas: txDataRpc.maxPriorityFeePerGas !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.maxPriorityFeePerGas) : undefined,\n      nonce: txDataRpc.nonce !== undefined ? utils_2.utils.convertHexToNumber(txDataRpc.nonce) : undefined\n    };\n    return txData;\n  },\n  /**\n   * Marshall transaction data\n   * @param txData transaction data to marshall\n   * @return marshalled transaction data\n   */\n  marshalTxData: function marshalTxData(txData) {\n    if (txData.from === undefined) {\n      throw new Error(\"txData must include valid 'from' value.\");\n    }\n    var callTxDataBase = Object.assign({}, txData);\n    delete callTxDataBase.from;\n    var callTxDataBaseRPC = exports.marshaller._marshalCallTxDataBase(callTxDataBase);\n    var txDataRPC = Object.assign(Object.assign({}, callTxDataBaseRPC), {\n      from: exports.marshaller.marshalAddress(txData.from)\n    });\n    var prunableIfUndefined = ['gasPrice', 'maxFeePerGas', 'maxPriorityFeePerGas', 'gas', 'value', 'nonce'];\n    _.each(txDataRPC, function (value, key) {\n      if (value === undefined && _.includes(prunableIfUndefined, key)) {\n        delete txDataRPC[key];\n      }\n    });\n    return txDataRPC;\n  },\n  /**\n   * Marshall call data\n   * @param callData call data to marshall\n   * @return marshalled call data\n   */\n  marshalCallData: function marshalCallData(callData) {\n    var callTxDataBase = Object.assign({}, callData);\n    delete callTxDataBase.from;\n    delete callTxDataBase.overrides;\n    var callTxDataBaseRPC = exports.marshaller._marshalCallTxDataBase(callTxDataBase);\n    var callDataRPC = Object.assign(Object.assign({}, callTxDataBaseRPC), {\n      from: callData.from === undefined ? undefined : exports.marshaller.marshalAddress(callData.from)\n    });\n    return callDataRPC;\n  },\n  /**\n   * Marshall call overrides parameter for for a geth eth_call.\n   * @param overrides overrides to marshal\n   * @return marshalled overrides\n   */\n  marshalCallOverrides: function marshalCallOverrides(overrides) {\n    var marshalled = {};\n    for (var address in overrides) {\n      if (address) {\n        var override = overrides[address];\n        var marshalledAddress = exports.marshaller.marshalAddress(address);\n        var marshalledOverride = marshalled[marshalledAddress] = {};\n        if (override.code !== undefined) {\n          marshalledOverride.code = override.code;\n        }\n        if (override.nonce !== undefined) {\n          marshalledOverride.nonce = utils_2.utils.encodeAmountAsHexString(override.nonce);\n        }\n        if (override.balance !== undefined) {\n          marshalledOverride.balance = utils_2.utils.encodeAmountAsHexString(override.balance);\n        }\n        if (Object.keys(marshalledOverride).length === 0) {\n          delete marshalled[marshalledAddress];\n        }\n      }\n    }\n    return marshalled;\n  },\n  /**\n   * Marshall address\n   * @param address address to marshall\n   * @return marshalled address\n   */\n  marshalAddress: function marshalAddress(address) {\n    if (utils_1.addressUtils.isAddress(address)) {\n      return ethUtil.addHexPrefix(address);\n    }\n    throw new Error(\"Invalid address encountered: \".concat(address));\n  },\n  /**\n   * Marshall block param\n   * @param blockParam block param to marshall\n   * @return marshalled block param\n   */\n  marshalBlockParam: function marshalBlockParam(blockParam) {\n    if (blockParam === undefined) {\n      return ethereum_types_1.BlockParamLiteral.Latest;\n    }\n    var encodedBlockParam = _.isNumber(blockParam) ? utils_2.utils.numberToHex(blockParam) : blockParam;\n    return encodedBlockParam;\n  },\n  /**\n   * Unmarshall log\n   * @param rawLog log to unmarshall\n   * @return unmarshalled log\n   */\n  unmarshalLog: function unmarshalLog(rawLog) {\n    var formattedLog = Object.assign(Object.assign({}, rawLog), {\n      logIndex: utils_2.utils.convertHexToNumberOrNull(rawLog.logIndex),\n      blockNumber: utils_2.utils.convertHexToNumberOrNull(rawLog.blockNumber),\n      transactionIndex: utils_2.utils.convertHexToNumberOrNull(rawLog.transactionIndex)\n    });\n    return formattedLog;\n  },\n  _marshalCallTxDataBase: function _marshalCallTxDataBase(callTxDataBase) {\n    var accessList;\n    if (callTxDataBase.accessList && Object.keys(callTxDataBase.accessList).length) {\n      accessList = Object.entries(callTxDataBase.accessList).map(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          address = _ref2[0],\n          storageKeys = _ref2[1];\n        return {\n          address: address,\n          storageKeys: storageKeys\n        };\n      });\n    }\n    var callTxDataBaseRPC = {\n      data: callTxDataBase.data,\n      to: callTxDataBase.to === undefined ? undefined : exports.marshaller.marshalAddress(callTxDataBase.to),\n      gasPrice: callTxDataBase.gasPrice === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.gasPrice),\n      maxFeePerGas: callTxDataBase.maxFeePerGas === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.maxFeePerGas),\n      maxPriorityFeePerGas: callTxDataBase.maxPriorityFeePerGas === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.maxPriorityFeePerGas),\n      gas: callTxDataBase.gas === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.gas),\n      value: callTxDataBase.value === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.value),\n      nonce: callTxDataBase.nonce === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.nonce),\n      accessList: accessList\n    };\n    return callTxDataBaseRPC;\n  }\n};","map":null,"metadata":{},"sourceType":"script"}